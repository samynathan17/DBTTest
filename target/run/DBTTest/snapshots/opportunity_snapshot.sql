
      merge into "DATAFLOTEST_DATABASE"."SNAPSHOTS"."OPPORTUNITY_SNAPSHOT_CHECK" as DBT_INTERNAL_DEST
    using "DATAFLOTEST_DATABASE"."SNAPSHOTS"."OPPORTUNITY_SNAPSHOT_CHECK__dbt_tmp" as DBT_INTERNAL_SOURCE
    on DBT_INTERNAL_SOURCE.dbt_scd_id = DBT_INTERNAL_DEST.dbt_scd_id

    when matched
     and DBT_INTERNAL_DEST.dbt_valid_to is null
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'update'
        then update
        set dbt_valid_to = DBT_INTERNAL_SOURCE.dbt_valid_to

    when not matched
     and DBT_INTERNAL_SOURCE.dbt_change_type = 'insert'
        then insert ("ID", "IS_DELETED", "ACCOUNT_ID", "IS_PRIVATE", "NAME", "DESCRIPTION", "STAGE_NAME", "AMOUNT", "PROBABILITY", "EXPECTED_REVENUE", "TOTAL_OPPORTUNITY_QUANTITY", "CLOSE_DATE", "TYPE", "NEXT_STEP", "LEAD_SOURCE", "IS_CLOSED", "IS_WON", "FORECAST_CATEGORY", "FORECAST_CATEGORY_NAME", "CAMPAIGN_ID", "HAS_OPPORTUNITY_LINE_ITEM", "PRICEBOOK_2_ID", "OWNER_ID", "CREATED_DATE", "CREATED_BY_ID", "LAST_MODIFIED_DATE", "LAST_MODIFIED_BY_ID", "SYSTEM_MODSTAMP", "LAST_ACTIVITY_DATE", "FISCAL_QUARTER", "FISCAL_YEAR", "FISCAL", "CONTACT_ID", "LAST_VIEWED_DATE", "LAST_REFERENCED_DATE", "HAS_OPEN_ACTIVITY", "HAS_OVERDUE_TASK", "LAST_AMOUNT_CHANGED_HISTORY_ID", "LAST_CLOSE_DATE_CHANGED_HISTORY_ID", "DELIVERY_INSTALLATION_STATUS_C", "TRACKING_NUMBER_C", "ORDER_NUMBER_C", "CURRENT_GENERATORS_C", "MAIN_COMPETITORS_C", "_FIVETRAN_SYNCED", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
        values ("ID", "IS_DELETED", "ACCOUNT_ID", "IS_PRIVATE", "NAME", "DESCRIPTION", "STAGE_NAME", "AMOUNT", "PROBABILITY", "EXPECTED_REVENUE", "TOTAL_OPPORTUNITY_QUANTITY", "CLOSE_DATE", "TYPE", "NEXT_STEP", "LEAD_SOURCE", "IS_CLOSED", "IS_WON", "FORECAST_CATEGORY", "FORECAST_CATEGORY_NAME", "CAMPAIGN_ID", "HAS_OPPORTUNITY_LINE_ITEM", "PRICEBOOK_2_ID", "OWNER_ID", "CREATED_DATE", "CREATED_BY_ID", "LAST_MODIFIED_DATE", "LAST_MODIFIED_BY_ID", "SYSTEM_MODSTAMP", "LAST_ACTIVITY_DATE", "FISCAL_QUARTER", "FISCAL_YEAR", "FISCAL", "CONTACT_ID", "LAST_VIEWED_DATE", "LAST_REFERENCED_DATE", "HAS_OPEN_ACTIVITY", "HAS_OVERDUE_TASK", "LAST_AMOUNT_CHANGED_HISTORY_ID", "LAST_CLOSE_DATE_CHANGED_HISTORY_ID", "DELIVERY_INSTALLATION_STATUS_C", "TRACKING_NUMBER_C", "ORDER_NUMBER_C", "CURRENT_GENERATORS_C", "MAIN_COMPETITORS_C", "_FIVETRAN_SYNCED", "DBT_UPDATED_AT", "DBT_VALID_FROM", "DBT_VALID_TO", "DBT_SCD_ID")
    ;

  